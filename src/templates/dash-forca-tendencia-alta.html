<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BTC Turbo - Força da tendência de alta</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #0f111a;
      color: #fff;
      text-align: center;
      font-family: system-ui, sans-serif;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
    }
    .grafico-titulo {
      margin-bottom: 10px;
      font-size: 15px;
      color: #888;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    h1 {
      font-size: 24px;
      color: #f7931a;
      margin-bottom: 20px;
      padding: 0 10px;
      font-weight: 700;
    }

   .menu-scroll {
      display: flex;
      justify-content: center; /* padrão em telas grandes */
      gap: 10px;
      margin-bottom: 30px;
      padding: 8px;
      border-bottom: 1px solid #333;
      overflow-x: auto;
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    @media (max-width: 768px) {
      .menu-scroll {
        justify-content: flex-start; /* alinha à esquerda no mobile */
      }
    }


    .menu-scroll::-webkit-scrollbar {
      display: none;
    }

    .menu-scroll a {
      flex: 0 0 auto;
      background-color: transparent;
      color: #888;
      font-weight: 600;
      text-decoration: none;
      padding: 10px 14px;
      border-bottom: 3px solid transparent;
      white-space: nowrap;
      transition: 0.3s;
      font-size: 16px;
    }

    .menu-scroll a:hover,
    .menu-scroll a:focus {
      color: #f7931a;
      border-bottom: 3px solid #f7931a;
    }

    .menu-scroll a.ativo {
      color: #f7931a;
      border-bottom: 3px solid #f7931a;
      background-color: #1e1e1e;
    }

    /* Esta é a principal mudança - organização dos gráficos em grade horizontal */
    .dashboard-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-bottom: 30px;
      width: 100%;
    }

    .dashboard-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      width: 100%;
      margin-bottom: 20px;
    }

    .grafico {
      width: 240px;
      background: #161b22;
      border-radius: 20px;
      padding: 20px 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 0;
    }

    .info-icon {
      width: 20px;
      height: 20px;
      cursor: pointer;
      vertical-align: middle;
    }

    .tooltip {
      margin-top: 5px;
      position: relative;
    }

    .tooltip-text {
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 13px;
      color: #ccc;
      background: #1e1e1e;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 6px 8px;
      position: absolute;
      bottom: -50px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
      white-space: nowrap;
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    @media (max-width: 768px) {
      .grafico {
        width: calc(50% - 20px);
        min-width: 200px;
      }
    }

    @media (max-width: 600px) {
      .grafico {
        width: 92vw;
        margin-bottom: 20px;
      }
      .menu-scroll a {
        font-size: 16px;
        padding: 10px 14px;
      }
    }
  </style>
</head>
<body>
  <h1>BTC Turbo - Força da tendência de alta</h1>
  <div class="menu-scroll">
    <a href="/webhook/painel-forca-medias" class="ativo">Tendência</a>
    <a href="/webhook/painel-forca-ciclos">Ciclos</a>
    <a href="/webhook/painel-forca-fundamentos">Fundamentos</a>
    <a href="/webhook/painel-risco-financeiro">R. Financeiro</a>
    <a href="/webhook/painel-risco-estrutura">R. Estrutura</a>
    <a href="/webhook/painel-risco-macro">R. Macro</a>
    <a href="/webhook/painel-risco-tecnico">R. Técnico</a>
    <a href="/webhook/painel-consolidado">Consolidado</a>
  </div>
  
  <!-- Todos os gráficos em uma única linha horizontal que quebra conforme necessário -->
  <div class="dashboard-grid">
    <!-- Resultado Consolidado -->
    <div class="grafico">
      <div class="grafico-titulo">
        <span class="grafico-label">Resultado Consolidado</span>
      </div>
      <canvas id="gaugeChart_consolidado" width="200" height="180"></canvas>
      <div id="classificacao_consolidado" class="classificacao">Agora: {{ $json.consolidado.score * 10}}  - {{ $json.consolidado.classificacao }}</div>
      <div class="tooltip">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="info-icon">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        <span class="tooltip-text">{{  $json.consolidado.racional}}</span>
      </div>
      <script>
        setTimeout(() => {
          renderGauge({
            canvasId: "gaugeChart_consolidado",
            score: {{$json.consolidado.score}} * 10,
            classificacaoId: "classificacao_consolidado"
          });
        }, 0);
      </script>
    </div>
            
    <!-- Score gráfico semanal -->
    <div class="grafico">
      <div class="grafico-titulo">
        <span class="grafico-label">Tempo gráfico - 1W</span>
      </div>
      <canvas id="gaugeChart_1w" width="200" height="180"></canvas>
      <div id="classificacao_1w" class="classificacao">Agora: {{ $json.emas["1w"].analise.score * 10}}  - {{ $json.emas["1w"].analise.classificacao }}</div>
      <div class="tooltip">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="info-icon">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        <span class="tooltip-text">{{ $json.emas["1w"].analise.observacao }}</span>
      </div>
      <script>
        setTimeout(() => {
          renderGauge({
            canvasId: "gaugeChart_1w",
            score: {{ $json.emas["1w"].analise.score }} * 10,
            classificacaoId: "classificacao_1w"
          });
        }, 0);
      </script>
    </div>
            
    <!-- Score gráfico diário -->
    <div class="grafico">
      <div class="grafico-titulo">
        <span class="grafico-label">Tempo gráfico - 1D</span>
      </div>
      <canvas id="gaugeChart_1d" width="200" height="180"></canvas>
      <div id="classificacao_1d" class="classificacao">Agora: {{ $json.emas["1d"].analise.score * 10}}  - {{ $json.emas["1d"].analise.classificacao }}</div>
      <div class="tooltip">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="info-icon">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        <span class="tooltip-text">{{ $json.emas["1d"].analise.observacao }}</span>
      </div>
      <script>
        setTimeout(() => {
          renderGauge({
            canvasId: "gaugeChart_1d",
            score: {{ $json.emas["1d"].analise.score }} * 10,
            classificacaoId: "classificacao_1d"
          });
        }, 0);
      </script>
    </div>
    
    <!-- Score gráfico 4h -->
    <div class="grafico">
      <div class="grafico-titulo">
        <span class="grafico-label">Tempo gráfico - 4H</span>
      </div>
      <canvas id="gaugeChart_4h" width="200" height="180"></canvas>
      <div id="classificacao_4h" class="classificacao">Agora: {{ $json.emas["4h"].analise.score * 10}}  - {{ $json.emas["4h"].analise.classificacao }}</div>
      <div class="tooltip">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="info-icon">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        <span class="tooltip-text">{{ $json.emas["4h"].analise.observacao }}</span>
      </div>
      <script>
        setTimeout(() => {
          renderGauge({
            canvasId: "gaugeChart_4h",
            score: {{ $json.emas["4h"].analise.score }} * 10,
            classificacaoId: "classificacao_4h"
          });
        }, 0);
      </script>
    </div>

    <!-- Score gráfico 1h -->
    <div class="grafico">
      <div class="grafico-titulo">
        <span class="grafico-label">Tempo gráfico - 1H</span>
      </div>
      <canvas id="gaugeChart_1h" width="200" height="180"></canvas>
      <div id="classificacao_1h" class="classificacao">Agora: {{ $json.emas["1h"].analise.score * 10}}  - {{ $json.emas["1h"].analise.classificacao }}</div>
      <div class="tooltip">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="info-icon">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        <span class="tooltip-text">{{ $json.emas["1h"].analise.observacao }}</span>
      </div>
      <script>
        setTimeout(() => {
          renderGauge({
            canvasId: "gaugeChart_1h",
            score: {{ $json.emas["1h"].analise.score }} * 10,
            classificacaoId: "classificacao_1h"
          });
        }, 0);
      </script>
    </div>

    <!-- Score gráfico 15m -->
    <div class="grafico">
      <div class="grafico-titulo">
        <span class="grafico-label">Tempo gráfico - 15M</span>
      </div>
      <canvas id="gaugeChart_15m" width="200" height="180"></canvas>
      <div id="classificacao_15m" class="classificacao">Agora: {{ $json.emas["15m"].analise.score * 10}}  - {{ $json.emas["15m"].analise.classificacao }}</div>
      <div class="tooltip">
        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="info-icon">
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        <span class="tooltip-text">{{ $json.emas["15m"].analise.observacao }}</span>
      </div>
      <script>
        setTimeout(() => {
          renderGauge({
            canvasId: "gaugeChart_15m",
            score: {{ $json.emas["15m"].analise.score }} * 10,
            classificacaoId: "classificacao_15m"
          });
        }, 0);
      </script>
    </div>
  </div>

  <!-- Script da função global -->
  <script>
    function renderGauge({ canvasId, score, classificacaoId }) {
      // canvasId: ID do elemento <canvas> onde o gráfico será desenhado
      // score: valor numérico (0 a 100) que define a posição do ponteiro
      // classificacaoId: ID do elemento onde a cor do texto da classificação será aplicada
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext('2d');

      // Define a cor da classificação com base no score
      let corTexto;
      if (score < 20) corTexto = "#e53935";   // Vermelho
      else if (score < 40) corTexto = "#f57c00"; // Laranja escuro
      else if (score < 60) corTexto = "#fbc02d"; // Amarelo
      else if (score < 80) corTexto = "#9acb82"; // Verde claro
      else corTexto = "#4caf50";               // Verde forte

      document.getElementById(classificacaoId).style.color = corTexto;

      // Cria o gráfico tipo doughnut com configuração sem preenchimento
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Score'],
          datasets: [{
            data: [100],
            backgroundColor: ['#0000'],
            borderWidth: 0,
            cutout: '80%',
          }]
        },
        options: {
          responsive: false,
          rotation: -Math.PI,
          circumference: Math.PI,
          plugins: {
            tooltip: { enabled: false },
            legend: { display: false }
          },
        },
        plugins: [{
          id: 'customGauge',
          // Plugin customizado que desenha os arcos e ponteiro após o gráfico
          afterDraw: (chart) => {
            const ctx = chart.ctx;
            const angle = (score / 100) * Math.PI;
            const cx = chart.width / 2;
            const cy = chart.height - 42;
            const r = chart.width / 2.4;

            ctx.save();

            // Função para desenhar cada arco de cor no gráfico
            const drawArc = (start, end, color) => {
              ctx.beginPath();
              ctx.arc(cx, cy, r, start, end);
              ctx.strokeStyle = color;
              ctx.lineWidth = 16;
              ctx.lineCap = "butt";
              ctx.stroke();
            };

            drawArc(Math.PI, Math.PI + Math.PI * 0.2 - 0.01, "#e53935");
            drawArc(Math.PI + Math.PI * 0.2, Math.PI + Math.PI * 0.4 - 0.01, "#f57c00");
            drawArc(Math.PI + Math.PI * 0.4, Math.PI + Math.PI * 0.6 - 0.01, "#fbc02d");
            drawArc(Math.PI + Math.PI * 0.6, Math.PI + Math.PI * 0.8 - 0.01, "#9acb82");
            drawArc(Math.PI + Math.PI * 0.8, 2 * Math.PI - 0.01, "#4caf50");

            // Cálculo da seta (ponteiro)
            const pointerLength = r * 0.9;
            const pointerWidth = 6;
            const angleRadians = Math.PI + angle;

            const x1 = cx + pointerLength * Math.cos(angleRadians);
            const y1 = cy + pointerLength * Math.sin(angleRadians);
            const x2 = cx + pointerWidth * Math.cos(angleRadians + Math.PI / 2);
            const y2 = cy + pointerWidth * Math.sin(angleRadians + Math.PI / 2);
            const x3 = cx + pointerWidth * Math.cos(angleRadians - Math.PI / 2);
            const y3 = cy + pointerWidth * Math.sin(angleRadians - Math.PI / 2);

            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.lineTo(x3, y3);
            ctx.closePath();
            ctx.fillStyle = "#444";
            ctx.fill();

            ctx.beginPath();
            ctx.arc(cx, cy, 6, 0, 2 * Math.PI);
            ctx.fillStyle = "#888";
            ctx.fill();

            ctx.font = "400 16px system-ui, sans-serif";
            ctx.fillStyle = "#888";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            // Número central do gráfico
            //ctx.fillText(score.toFixed(0), cx, cy - 40);

            ctx.font = "400 11px system-ui, sans-serif";
            ctx.fillStyle = "#888";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            const x0 = cx + r * Math.cos(Math.PI);
            const y0 = cy + r * Math.sin(Math.PI);
            const x100 = cx + r * Math.cos(0);
            const y100 = cy + r * Math.sin(0);
            // Texto "0" no início do arco
            ctx.fillText("0", x0, y0 + 15);
            // Texto "100" no fim do arco
            ctx.fillText("100", x100 - 3, y100 + 15);

            ctx.restore();
          }
        }]
      });
    }
  </script>
</body>
</html>