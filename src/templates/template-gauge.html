<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Veloc√≠metro BTC</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* ================================
       üé® ESTILO GERAL DA P√ÅGINA
    ================================= */
    body {
      background: #0f111a;
      color: #fff;
      text-align: center;
      font-family: 'Arial', sans-serif;
      padding: 30px;
    }

    /* ================================
       üß± CARD DO GR√ÅFICO
    ================================= */
    .grafico {
      width: 240px;
      margin: auto;
      background: #161b22;
      border-radius: 20px;
      padding: 20px 10px;
    }

    /* ================================
       üìè CONTAINER PARA O CANVAS
    ================================= */
    .gauge-wrapper {
      height: 160px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* ================================
       üè∑Ô∏è TEXTO DE CLASSIFICA√á√ÉO
    ================================= */
    .classificacao {
      margin-top: 12px;
      font-weight: bold;
      font-size: 15px;
    }

    /* ================================
       üè∑Ô∏è TEXTO DE OBSERVA√á√ÉO
    ================================= */
    .observacao {
      margin-top: 10px;
      font-size: 10px;
      color: #ccc;
      padding: 0 10px;
      white-space: pre-line;
      word-break: break-word;
    }

    .titulo {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .badge {
      background-color: #f7931a;
      color: #fff;
      font-size: 12px;
      font-weight: bold;
      padding: 2px 8px;
      border-radius: 6px;
      display: inline-block;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <div class="grafico">
    <div class="badge">15m</div>
    <!--<div class="titulo">EMA9 x EMA21</div>-->

    <div class="gauge-wrapper">
      <canvas id="gaugeChart"></canvas>
    </div>

    <div id="label" class="classificacao">{{ $json.emas["15m"].analise.classificacao }}</div>
    <div class="observacao">{{ $json.emas["15m"].analise.observacao }}</div>
  </div>

  <script>
    const score = {{ $json.emas["15m"].analise.score }};
    const restante = 10 - score;

    const cor = score >= 7 ? '#00e676' :
                score >= 4 ? '#ffc107' :
                '#f44336';

    const ctx = document.getElementById('gaugeChart').getContext('2d');

    new Chart(ctx, {
      type: 'doughnut',
      data: {
        datasets: [{
          data: [score, restante],
          backgroundColor: [cor, '#6D676E'],
          borderRadius: [0, 0],
          borderWidth: 0,
        }]
      },
      options: {
        responsive: true,
        rotation: -120,
        circumference: 240,
        cutout: '80%',
        plugins: {
          tooltip: { enabled: false },
          legend: { display: false }
        }
      },
      plugins: [
        {
          id: 'centerText',
          beforeDraw: (chart) => {
            const { width, height } = chart;
            const ctx = chart.ctx;
            const scoreText = String(score);

            ctx.save();
            ctx.font = "bold 26px Arial";
            ctx.fillStyle = "#fff";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(scoreText, width / 2, height / 2 + 10);
            ctx.restore();
          }
        }
      ]
    });

    document.getElementById('label').style.color = cor;
  </script>

</body>
</html>
